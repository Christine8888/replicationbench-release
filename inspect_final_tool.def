Bootstrap: docker
From: python:3.11-slim

%post
    # Update and install system dependencies
    apt-get update && apt-get install -y \
        build-essential \
        gcc \
        g++ \
        gfortran \
        git \
        curl \
        wget \
        vim \
        && rm -rf /var/lib/apt/lists/*

    # Upgrade pip
    python3 -m pip install --upgrade pip setuptools wheel

    # Install scientific Python packages
    python3 -m pip install \
        numpy \
        scipy \
        matplotlib \
        pandas \
        astropy \
        scikit-learn \
        scikit-image \
        seaborn \
        datasets \
        plotly \
        sympy \
        networkx \
        numba \
        h5py \
        tqdm \
        pyyaml \
        toml \
        requests \
        filelock

    # Install PyTorch with CUDA 12.6 support (includes CUDA runtime libs)
    python3 -m pip install torch --index-url https://download.pytorch.org/whl/cu126

    # Install inspect-ai
    python3 -m pip install inspect-ai

    # Install additional useful tools
    python3 -m pip install \
        jupyter \
        ipython \
        black \
        pytest

%environment
    export LC_ALL=C
    export PATH=/usr/local/bin:$PATH

%runscript
    exec "$@"

%labels
    Author christine
    Version 1.0
    Description Inspect AI environment with Python scientific stack and CUDA support

%help
    This container provides:
    - Python 3.11
    - Scientific Python stack (numpy, scipy, matplotlib, astropy, etc.)
    - PyTorch with CUDA 12.6 support (includes CUDA runtime libraries)
    - Inspect AI framework
    - C/C++ compilers (gcc, g++, gfortran)

    Usage:
        singularity exec image.sif python3 script.py
        singularity exec --nv image.sif python3 gpu_script.py  # with GPU support

    The --nv flag exposes host CUDA drivers for GPU acceleration.
